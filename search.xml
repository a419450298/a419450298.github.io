<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>搭建samba服务实现文件共享</title>
      <link href="/2025/01/01/%E6%90%AD%E5%BB%BAsamba%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/"/>
      <url>/2025/01/01/%E6%90%AD%E5%BB%BAsamba%E6%9C%8D%E5%8A%A1%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E5%85%B1%E4%BA%AB/</url>
      
        <content type="html"><![CDATA[<div class="video-container"><iframe src="//player.bilibili.com/player.html?isOutside=true&aid=22195097&bvid=BV1GW411j7TG&cid=36719721&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe></div><style>.video-container { position: relative; padding-top: 56.25%; } .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><p>在一些中小型网络，或者企业的内部网中，利用 Linux 建立文件服务器是一个很好的解决方案。针对企业内部网中的绝大部分客户机采用 Windows 的情况，我们可以通过使用 Samba 来实现文件服务器功能。<br>Samba 是在 Linux 及 Unix 上实现 SMB（Server Message Block）协议的一个免费软件，由服务器及客户端程序构成。这里我们只介绍服务器程序。<br>我们首先介绍一些 SMB 协议的情况。SMB 协议是建立在 NetBIOS 协议之上的应用协议，是基于 TCP138、139 两个端口的服务。NetBIOS 出现之后，Microsoft 就使用 NetBIOS 实现了一个网络文件&#x2F;打印服务系统。这个系统基于 NetBIOS 设定了一套文件共享协议，Microsoft 称之为 SMB（Server Message Block）协议。这个协议被用于 Lan Manager 和 Windows 服务器系统中，实现不同计算机之间共享打印机和文件等。因此，为了让 Windows 和 Unix&#x2F;Linux 计算机相集成，最好的办法就是在 Unix&#x2F;Linux 计算机中安装支持 SMB 协议的软件。这样使用 Windows 的客户端不需要更改设置，就能像使用 Windows NT 或 Windows 2000 服务器一样，使用 Unix&#x2F;Linux 计算机上的共享资源了。Samba 使 SMB 协议运行在 NetBIOS 协议上，并且使用 Windows 的 NetBEUI 协议让 Unix&#x2F;Linux 服务器可以在 Windows 的网络邻居上被访问到。</p><h2 id="安装："><a href="#安装：" class="headerlink" title="安装："></a>安装：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##（首先更新系统的软件下载源）</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"><span class="comment">##（可选对ubuntu进行系统升级！）</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get upgrade</span><br><span class="line"><span class="comment">## 正式安装</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install samba</span><br><span class="line"><span class="comment">## 安装结束后创建Samba用户，用户名及密码</span></span><br><span class="line"><span class="built_in">sudo</span> smbpasswd -a xxx  <span class="comment">## xxx为用户名</span></span><br><span class="line"><span class="comment">##（输入密码2次：）</span></span><br><span class="line">New SMB password:</span><br><span class="line">Retype new SMB password:</span><br><span class="line"></span><br><span class="line"><span class="comment">## 备份原配置</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/samba/smb.conf /etc/samba/smb.conf.bak</span><br><span class="line"><span class="comment">## 编辑配置文件</span></span><br><span class="line"><span class="built_in">sudo</span> gedit /etc/samba/smb.conf</span><br><span class="line"><span class="comment">## 如果提示 gedit:1505157): Gtk-WARNING **: 23:46:14.954: cannot open display:可以通过vim进行编辑</span></span><br><span class="line"><span class="built_in">sudo</span> vim /etc/samba/smb.conf</span><br></pre></td></tr></table></figure><h2 id="配置："><a href="#配置：" class="headerlink" title="配置："></a>配置：</h2><h3 id="配置文件常用指令说明"><a href="#配置文件常用指令说明" class="headerlink" title="配置文件常用指令说明:"></a>配置文件常用指令说明:</h3><p>comment&#x3D;STRING :注释；<br>path&#x3D;&#x2F;PATH&#x2F;TO&#x2F;FILENAME :当前共享所映射的文件系统路径；<br>browseable&#x3D;YES :是否可浏览，指是否可被用户查看；<br>guest ok&#x3D;YES :是否允许来宾账号访问；<br>browseable &#x3D; No :是否公开目录<br>writable&#x3D;YES :是否可写；<br>read only &#x3D; no|yes :是否为只读<br>write list&#x3D;&#x2F;PATH&#x2F;TO&#x2F;user_list :拥有写权限的用户列表；</p><p><strong>在文件尾部添加以下内容，根据自己需要修改，并保存文件</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[share]</span><br><span class="line">path = /media/pi  <span class="comment">## 路径建议提前分配好读写权限 sudo chmod -R 777 /media/pi</span></span><br><span class="line">available = <span class="built_in">yes</span></span><br><span class="line">browsealbe = <span class="built_in">yes</span></span><br><span class="line">valid usere = pi     <span class="comment">## 创建的用户名</span></span><br><span class="line">writable = <span class="built_in">yes</span></span><br><span class="line">guest ok = no</span><br><span class="line"><span class="built_in">read</span> only = no</span><br></pre></td></tr></table></figure><ul><li>[share] 是共享文件夹显示的名称</li><li>上面配置了禁止匿名登录，允许用户读写文件</li><li>更多配置方式<a href="https://www.samba.org/">https://www.samba.org/</a></li><li>注意 如果共享的文件夹中包含中文可能会出现乱码，建议在[global]修改字符集为 utf-8</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 原有</span></span><br><span class="line">   display charset = cp936</span><br><span class="line">   unix charset = cp936</span><br><span class="line">   dos  charset = cp936</span><br><span class="line"><span class="comment">## 更改为</span></span><br><span class="line">   dos charset = UTF-8</span><br><span class="line">   unix charset = utf-8</span><br><span class="line">   display charset = utf-8</span><br></pre></td></tr></table></figure><ul><li>如果映射过慢，可采用如下方法, 通过 testparm 检查配置</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 在[global]下添加如下配置</span></span><br><span class="line">   <span class="built_in">read</span> raw = Yes</span><br><span class="line">   write raw = Yes</span><br><span class="line">   socket options = TCP_NODELAY IPTOS_LOWDELAY SO_RCVBUF=131072 SO_SNDBUF=131072</span><br><span class="line">   min receivefile size = 16384</span><br><span class="line">   use sendfile = <span class="literal">true</span></span><br><span class="line">   aio <span class="built_in">read</span> size = 16384</span><br><span class="line">   aio write size = 16384</span><br><span class="line">   max xmit = 65535</span><br><span class="line">   max connections = 0</span><br><span class="line">   deadtime = 0</span><br><span class="line"><span class="comment">## 配置结束</span></span><br><span class="line">[printers]</span><br><span class="line">   comment = All Printers</span><br></pre></td></tr></table></figure><h2 id="启动："><a href="#启动：" class="headerlink" title="启动："></a>启动：</h2><p>保存退出:wq</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/smbd restart  <span class="comment">## 重启SMB 使配置生效</span></span><br></pre></td></tr></table></figure><p>这个时候 samba 的安装配置工作就已经完成了，当然可以保底操作一下,确保一切正常</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt install cifs-utils -y <span class="comment">## 安装cifs</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install samba -y <span class="comment">## 更新samba</span></span><br><span class="line"><span class="built_in">sudo</span> ufw allow samba <span class="comment">## 防火墙豁免</span></span><br><span class="line">/etc/init.d/smbd restart <span class="comment">## 重启即可</span></span><br></pre></td></tr></table></figure><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><p>win + R 输入\192.168.1.66\share 输入实际的主机 ip 可通过 ifconfig 在 linux 机器上查</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tunpl | grep smbd</span><br></pre></td></tr></table></figure><ul><li>注意：如果是服务商接入会屏蔽掉 445 139 端口<br>在配置文件的[global]项中加入一行</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smb ports = 1314</span><br></pre></td></tr></table></figure><h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>samba 服务器功能<br>1）提供 Windows 风格文件或打印机的共享<br>2）在 Windows 网络中解析 NETBIOS 名字<br>3）提供 smb 客户功能<br>4）提供一个命令行工具，利用该工具限制支持 Windows 的某些管理功能</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>写给2025的一封信</title>
      <link href="/2024/12/29/%E5%86%99%E7%BB%992024%E7%9A%84%E4%B8%80%E5%B0%81%E4%BF%A1/"/>
      <url>/2024/12/29/%E5%86%99%E7%BB%992024%E7%9A%84%E4%B8%80%E5%B0%81%E4%BF%A1/</url>
      
        <content type="html"><![CDATA[<h1 id="该文只是测试"><a href="#该文只是测试" class="headerlink" title="该文只是测试"></a>该文只是测试</h1><p>你好啊，伙计！</p><p>我是从2024年给你发信的一名程序员。在这个代码和咖啡的世界里，我正忙着debug我的生活，同时也在期待你的到来。咱们来聊聊我对你的一些期待和计划吧。</p><h2 id="版本控制：回顾过去"><a href="#版本控制：回顾过去" class="headerlink" title="版本控制：回顾过去"></a>版本控制：回顾过去</h2><p>在过去的这个版本年里，我们解决了不少bug，也部署了一些新功能。虽然有些feature上线的时候有点磕磕绊绊，但总的来说，用户体验还算不错。感谢过去的这一年，它让我们的代码库更加健壮。</p><h2 id="功能规划：展望未来"><a href="#功能规划：展望未来" class="headerlink" title="功能规划：展望未来"></a>功能规划：展望未来</h2><p>对于你，2025，我已经在脑海里勾勒出了一些新功能和改进点。比如，我希望我们的AI技术能够更加智能，帮助我们解决更复杂的问题。我还期待云服务能够更加稳定，让我们的数据存储和计算更加高效。</p><h2 id="个人分支：个人愿望"><a href="#个人分支：个人愿望" class="headerlink" title="个人分支：个人愿望"></a>个人分支：个人愿望</h2><p>在我的个人分支上，我有一些commit要push。比如，我想要提升我的编程技能，学习新的编程语言和框架。我还计划优化我的工作流程，提高效率，这样我就能有更多的时间来研究新的技术，或者是玩玩游戏，放松一下。</p><h2 id="团队协作：社会愿景"><a href="#团队协作：社会愿景" class="headerlink" title="团队协作：社会愿景"></a>团队协作：社会愿景</h2><p>在团队协作方面，我期待我们能够更加紧密地合作。无论是开源社区还是跨部门的项目，我希望我们能够打破壁垒，共享知识，共同推动技术的进步。我还希望我们能够更加关注技术的伦理和社会影响，确保我们的创新能够惠及每一个人。</p><h2 id="结语："><a href="#结语：" class="headerlink" title="结语："></a>结语：</h2><p>好了，2025，这就是我对你要到来的一些期待。我知道，就像编程一样，生活也会有bug和unexpected behavior，但我相信，只要我们持续迭代，不断优化，我们就能迎来一个更加精彩的版本。</p><p>期待与你见面！</p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
